# Header Processor

<!-- status autogenerated section -->
| Status        |           |
| ------------- |-----------|
| Stability     | [development]: traces, metrics, logs   |
| Distributions | [contrib] |
| Warnings      | [Identity Conflict](#warnings) |
| [Code Owners](https://github.com/open-telemetry/opentelemetry-collector-contrib/blob/main/CONTRIBUTING.md#becoming-a-code-owner)    | [@vincentfree](https://www.github.com/vincentfree) |

[development]: https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/component-stability.md#development
[contrib]: https://github.com/open-telemetry/opentelemetry-collector-releases/tree/main/distributions/otelcol-contrib
<!-- end autogenerated section -->

The Header Processor extracts HTTP headers from the request context and sets them as attributes on telemetry data (traces, metrics, logs). This processor enables users to capture header information for observability purposes, such as tracking request metadata, user agents, correlation IDs, or custom headers.

## Configuration

Please refer to [config.go](./config.go) for the config spec.

The following settings are available:

- `headers`: A list of header extraction configurations.
    - `name`: The case-insensitive name of the HTTP header to extract.
    - `attribute`: The target attribute name (optional, defaults to the header name).
    - `prefix`: An optional prefix to apply to the attribute name for this specific header.
- `prefix`: A global prefix applied to all extracted headers (optional). If both a per-header prefix and a global prefix are specified, the per-header prefix takes precedence.
- `separator`: The separator used when joining multiple values for the same header (default: `;`).
- `include_all`: When set to `true`, all headers from the context are extracted. Defaults to `false`.
- `exclude_patterns`: A list of regex patterns used to exclude headers when `include_all` is set to `true`.

### Example Configuration

```yaml
processors:
  headers:
    # List of header extraction configurations
    headers:
      - name: "user-agent"           # Header name to extract
        attribute: "http.user_agent" # Target attribute name (optional, defaults to header name)
        prefix: "header."            # Optional prefix for attribute name
        
      - name: "x-correlation-id"
        attribute: "correlation_id"
        
      - name: "authorization"
        attribute: "auth_header"
        prefix: "request."
        
    # Global settings
    prefix: "http.header."           # Global prefix applied to all headers (optional)
    separator: ";"                   # Separator for multiple header values (default: ";")
    include_all: false               # Extract all headers (default: false)
    exclude_patterns:                # Regex patterns for headers to exclude when include_all is true
      - "^authorization$"
      - "^cookie$"
```

## Use Cases

### 1. Request Tracing

Extract specific correlation IDs to link telemetry with external systems.

```yaml
processors:
  headers:
    headers:
      - name: "x-trace-id"
        attribute: "trace.external_id"
      - name: "x-request-id"
        attribute: "request.id"
```

### 2. User Agent Analysis

Capture client information for better understanding of traffic patterns.

```yaml
processors:
  headers:
    prefix: "http."
    headers:
      - name: "user-agent"
        attribute: "user_agent"
      - name: "accept"
        attribute: "accept"
```

### 3. Custom Header Extraction

Capture business-specific metadata from headers.

```yaml
processors:
  headers:
    headers:
      - name: "x-tenant-id"
        attribute: "tenant.id"
        prefix: "custom."
      - name: "x-api-version"
        attribute: "api.version"
        prefix: "custom."
```

### 4. Comprehensive Header Capture

Capture all headers except sensitive ones.

```yaml
processors:
  headers:
    include_all: true
    prefix: "http.header."
    exclude_patterns:
      - "^authorization$"
      - "^cookie$"
      - "^x-forwarded-.*"
```

## Security and Privacy

The Header Processor can potentially capture sensitive information if headers like `Authorization` or `Cookie` are extracted. 

- Use `exclude_patterns` when `include_all` is enabled to prevent accidental extraction of sensitive data.
- It is recommended to explicitly list only the headers you need when possible.
- Be aware that some headers might contain PII (Personally Identifiable Information).

## Warnings

- [Identity Conflict](https://github.com/open-telemetry/opentelemetry-collector/blob/main/docs/standard-warnings.md#identity-conflict): Adding new attributes to data points is generally safe, but be cautious if these attributes are used for identity in downstream systems.
